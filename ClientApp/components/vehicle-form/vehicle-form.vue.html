<template>
    <div class="main">

        <div class="widget">
            
            <div class="title">Create Vehicle</div>
            <div class="chart">
                <div class="error-block error-bag" v-if="errorBag.length > 0">  
                    <p v-for="er in errorBag">{{er}}</p>                  
                    <p>There are some errors! Please correct them and proceed.</p>
                </div>


                <!-- <v-select v-model="selected" :options="features"></v-select> -->

                <form class="form-vetical form" @submit.prevent="validateBeforeSubmit()">
                    <div class="form-group">
                        <label for="make">Make</label>
                        <select v-validate="'required'" name="make" @change="changeVehicle" v-model="vehicleForm.makeId" id="make" class="form-control">                    
                            <option></option>
                            <option v-for="make in makes" :value="make.id">{{ make.name }}</option>                           
                        </select>

                        <i v-show="errors.has('make')" class="fa fa-warning"></i>
                        <span v-show="errors.has('make')" class="help is-danger">{{ errors.first('make') }}</span>
                    </div>

                    <div class="form-group" v-if="models.length">
                        <label for="models">Model</label>
                        <select v-validate="'required'" name="models" id="models" class="form-control" v-model="vehicleForm.modelId">   
                            <option></option>                         
                            <option v-for="model in models" :value="model.id">{{ model.name }}</option>
                        </select>
                        <i v-show="errors.has('models')" class="fa fa-warning"></i>
                        <span v-show="errors.has('models')" class="help is-danger">{{ errors.first('models') }}</span>
                    </div>

                    <div class="form-group">
                        <p>Is the vehicle registered?</p>

                        <label for="isRegistered" class="radio-inline">
                            <input v-validate="'required'"
                            v-model="vehicleForm.isRegistered" 
                            value="true" id="isRegistered" type="radio" name="registered"> Yes
                        </label>
                        <label for="notRegistered" class="radio-inline">
                            <input v-model="vehicleForm.isRegistered" value="false" id="notRegistered" type="radio" name="registered"> No
                        </label><br/>

                        <i v-show="errors.has('registered')" class="fa fa-warning"></i>
                        <span v-show="errors.has('registered')" class="help is-danger">{{ errors.first('registered') }}</span>
                    </div>


                    <h3>Feature</h3>
                    <div class="form-group">
                        <div class="checkbox" v-for="feature in features">
                            <label :for="'feature'+feature.id">
                                <input v-model="vehicleForm.features" :id="'feature'+feature.id" 
                                type="checkbox" :value="feature.id" 
                                class="checkbox"
                                name="features"
                                v-validate="'required'"                                                              
                                > {{ feature.name }}
                            </label>
                        </div>
                        <i v-show="errors.has('features')" class="fa fa-warning"></i>
                        <span v-show="errors.has('features')" class="help is-danger">{{ errors.first('features') }}</span>
                    </div>

                    <h3>Contact</h3>

                    <div class="form-group">
                        <label for="name">Name</label>
                        <input v-model="vehicleForm.contact.name" type="text" id="name" name="name" v-validate="'required|:max:2'" :class="{'input': true, 'is-danger': errors.has('name') }"
                            class="form-control input-sm">

                        <i v-show="errors.has('name')" class="fa fa-warning"></i>
                        <span v-show="errors.has('name')" class="help is-danger">{{ errors.first('name') }}</span>

                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input v-model="vehicleForm.contact.email" v-validate="'required|email'" name="email" type="text" id="email" class="form-control input-sm"
                            :class="{'input': true, 'is-danger': errors.has('email') }">

                        <i v-show="errors.has('email')" class="fa fa-warning"></i>
                        <span v-show="errors.has('email')" class="help is-danger">{{ errors.first('email') }}</span>

                    </div>

                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input v-model="vehicleForm.contact.phone" type="text" id="phone" v-validate="'required|numeric|max:13'" name="phone" :class="{'input': true, 'is-danger': errors.has('phone')}"
                            class="form-control input-sm">

                        <i v-show="errors.has('phone')" class="fa fa-warning"></i>
                        <span v-show="errors.has('phone')" class="help is-danger">{{ errors.first('phone') }}</span>

                    </div>

                    <button class="btn btn-primary">{{ vehicleForm.formMode.button }}</button>
                    <button v-if="vehicleForm.id" @click="deleteVehicle(vehicleForm.id)" type="button" class="btn btn-danger">Delete</button>

                </form>
            </div>
        </div>

        <div class="widget">
            <div class="title">Test form</div>
            <div class="chart">
              
                <router-link to="/vehicle/new" :exact="true" class="btn-link">
                    <span><i class="material-icons">add_circle</i> </span><span class="icon-text"> Create</span>
                </router-link>

                <div class="well">
                    <div class="form-group">
                        <div class="input-group col-md-3">
                            <label for="filter">filter make</label>
                            <select class="form-control" name="filter" id="filter" v-model="filter.makeId" @change="filterVehicles()">
                                
                                <option v-for="m in makes" :value="m.id">{{m.name}}</option>
                            </select>  
                        </div>                      
                    </div>

                    <div class="form-group">
                        <div class="input-group col-md-3">
                            <label for="filter">filter model</label>
                            <select class="form-control" name="filter" id="filter" v-model="filter.modelId" @change="filterVehicles()">
                                
                                <option v-for="md in modelsBag" :value="md.id">{{md.name}}</option>
                            </select>  
                        </div>                      
                    </div>
                    <button v-if="filter.makeId || filter.modelId" class="btn btn-default btn-xs" @click="resetFilter()">&times</button>
                </div>
                
               

                               
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>Make</th>
                            <th>Model</th>
                            <th>Features</th>
                            <th>Contact</th>
                            <th>Last Updated</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr v-for="vehicle in vehicles">
                            <td><a @click="setEdit(vehicle)" href="javascript:void(0)"> {{ vehicle.make.name }}</a></td>
                            <td><a @click="deleteVehicle(vehicle.id)" class="text-danger" href="javascript:void(0)"> {{ vehicle.model.name }} </a></td>
                            <td>
                                <span v-for="f in vehicle.features">
                                    {{ f.name }}
                                </span>
                            </td>
                            <td>{{ vehicle.contact.name }} | {{ vehicle.contact.email }} | {{ vehicle.contact.phone }}</td>
                            <td>{{ vehicle.lastUpdate }}</td>
                        </tr>
                    </tbody>
                </table>

            </div>
        </div>

        
        <div v-if="features.length">

        </div>
        <p v-else>Loading data.....</p>

    </div>
</template>

<script src="./vehicle-form.ts"></script>